# 液压支架顶梁/采煤机摇臂检测最初版本       

使用传统的图像增强算法, 比如拉普拉斯变换, 直方图拉伸, gamma 变换 和 log 变换.    

## 边缘检测算法     

(1) 使用用户预先定好的一条顶梁线开始, 结合采煤机的运动速度和摄像机成像平面与顶梁之间的角度关系, 实现回环检测;   

(2) 直接对 ``图像增强`` 后的图像使用轮廓检测 + 霍夫直线检测, 提取直线边缘.  

(3) 目前具体的实现策略: 绘制一条先验的直线, 然后进行检测, 在 10 帧内选择 ``斜率最相近(使用向量夹角来度量)`且`和原点的距离相差最小`` 的一条直线作为新的顶梁位置.    
- 提前设置一秒内直线斜率和截距变化的阈值范围.   
- 对固定的帧数进行统计, 如果超出给定的帧数范围后仍然没有检测到直线, 那么就需要重新调整阈值.     

(4) 动态改变阈值.  
- 如果可以频繁检测到直线, 那么不断减小阈值.    
- 如果连续很多帧没有检测到直线了, 那么就增大阈值. 防止累积误差导致直线完全偏移阈值范围.   

(5) 阈值调整的过程不是线性变化, 而是指数级变化.    

## Run   

./topline  

默认参数是: 

- 待处理视频文件的路径名;  
- 读取视频的 fps=40;    
- 输出结果保存在程序运行路径下, 文件名为 "output.avi".      

注意: 应该更改为正确目录下的视频文件.  

## Compile

本程序中使用了三个库: OpenCV, glog, clbas, 因此, 编译之前一定要先配置好这几个库.   

同样地, 对于后边的几个版本, 也同样需要配置这三个库.   


## log 文件   

程序中使用 glog 记录关键的处理数据, log 文件位于 logs/ 目录下, 由于 log 文件也是会占用一部分磁盘空间的, 因此要定期进行备份清理.    

